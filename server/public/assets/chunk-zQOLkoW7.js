import{c as ce,r as c,a as n,j as e,F as me,B as he,C as ue,d as pe,L as ge,e as be,f as fe,p as Ne,g as ye,h as xe,P as ve}from"./index-Cli15I6T.js";import{a as V}from"./chunk-D8rVyQy1.js";import{U as q}from"./chunk-CFrYhmIi.js";import{g as we}from"./chunk-Dwtk4s3g.js";import{M as Se,s as Ee}from"./chunk-BAkAwKmV.js";import{X as Ce}from"./chunk-BEm9iFIz.js";const Te=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],$e=ce("Plus",Te);async function Ae(){try{const m=await V.get(`${q}coordinator`,{withCredentials:!0,headers:{"Content-Type":"application/json"}});return console.log("Coordinator Data is: ",m),m.data}catch{console.log("Error: ")}}async function ke(){try{const m=await V.get(`${q}coordinator/eventParticipants`,{withCredentials:!0,headers:{"Content-Type":"application/json"}});return console.log("Participants Data:",m.data),m.data}catch(m){return console.error("Error fetching participants:",m),[]}}ue.register(pe,ge,be,fe,Ne,ye,xe,ve);const _e=()=>{const[m,f]=c.useState([]),[t,b]=c.useState(null),[S,H]=c.useState(!1),[E,j]=c.useState("scores"),[u,W]=c.useState({coordinatorName:"Loading...",coordinatorEmail:"Loading...",coordinatorEvent:""}),[x,M]=c.useState(""),[C,_]=c.useState(""),[z,U]=c.useState(!1),[X,T]=c.useState(!1),[F,L]=c.useState(null),[$,A]=c.useState(""),[k,P]=c.useState(""),[N,y]=c.useState({}),[I,Z]=c.useState(!1);c.useEffect(()=>{(async()=>{try{const r=await Ae();W(r)}catch(r){alert("Try Again: Network Issue"),console.error("Error fetching coordinator info:",r)}})()},[]),c.useEffect(()=>{if(!u.coordinatorEvent)return;(async()=>{try{const s=["cultural","gaming","technical"].map(async l=>{const d=await we(l);if(!d||!Array.isArray(d))return[];const h=await ke(),p=new Set,D=[];return h.forEach(g=>{const v=Object.keys(g)[0],ie=g[v];Object.entries(ie).forEach(([B,R],le)=>{let w=D.length+le+1;for(;p.has(w);)w++;p.add(w);let de=B.split(/[\s-]+/)[1];D.push({id:w,orderID:v,collegeCode:`KA_${v}_${de}`,teamName:B,emails:Array.isArray(R)?R:[String(R)],score:0})})}),d.filter(g=>u.coordinatorEvent.toUpperCase()===g.eventID).map(g=>({id:g.eventID,name:g.eventName,participants:D.filter(v=>!0),rounds:u.eventRounds?u.eventRounds:["Round 1"]}))}),o=(await Promise.all(s)).flat();f(o),o.length===1&&b(o[0])}catch(r){console.error("Error fetching events:",r)}})()},[u.coordinatorEvent]),c.useEffect(()=>{t&&y(a=>{if(a[t.id])return a;const r={[t.id]:{}};return t.participants.forEach(s=>{r[t.id][s.id]={total:0}}),{...a,...r}})},[t]);const K=a=>Object.keys(a).filter(r=>r!=="total"&&a[r]!==void 0).reduce((r,s)=>r+(a[s]||0),0),G=(a,r,s)=>{t&&y(i=>{const o=i[t.id]||{},l=o[a]||{total:0};let d=s===""?void 0:Math.min(100,Math.max(0,parseInt(s)||0));const h={...l};return d===void 0?delete h[r]:h[r]=d,h.total=K(h),{...i,[t.id]:{...o,[a]:h}}})},J=async()=>{if(!t)return;const a={id:t.id,coordinator:u.coordinatorName,rounds:t.rounds,status:"pending",submittedAt:new Date().toISOString(),participants:t.participants.map(r=>({id:r.id,name:r.teamName,email:r.emails[0],collegeCode:r.collegeCode,roundScores:N[t.id][r.id]||{total:0}}))};try{const r=await Ee(a);alert(r?`Scores submitted successfully for ${t.name}! Awaiting faculty approval.`:`Error in submission for ${t.name}! Re-enter the data.`)}catch(r){console.error("Error submitting scores:",r),alert("Failed to submit scores. Please try again.")}},O=()=>{if(!t)return[];const a=new Map,r=N[t.id]||{};return t.participants.forEach(s=>{const i=r[s.id]||{total:0},o=`${s.teamName}-${s.emails[0]}`;a.set(o,{score:i.total,clgCode:s.collegeCode,email:s.emails[0]||"No email"})}),Array.from(a.entries()).map(([s,{score:i,email:o,clgCode:l}])=>{const[d]=s.split("-");return{teamName:d,score:i,email:o,clgCode:l}}).sort((s,i)=>i.score-s.score)},Q=()=>{if(!t)return{labels:[],datasets:[]};const a=N[t.id]||{},r=t.participants.map(i=>`${i.teamName} (${i.emails[0]})`),s=t.rounds.map((i,o)=>{const l=`round${o+1}`,d=o*137%360;return{label:i,data:t.participants.map(h=>{const p=a[h.id]||{};return p[l]!==void 0?p[l]:0}),backgroundColor:`hsla(${d}, 70%, 60%, 0.5)`,borderColor:`hsl(${d}, 70%, 50%)`,borderWidth:1}});return{labels:r,datasets:s}},Y=a=>{const r=m.find(s=>s.id===a);r&&b(r)},ee=()=>{if(!x.trim()||!C.trim()||!t)return;const a=t.participants.map(o=>o.id),s=(a.length>0?Math.max(...a):0)+1,i={id:s,orderID:t.id,collegeCode:`KA_${t.id}_${x.split(" ")[0]}`,teamName:x,emails:[C],score:0};f(o=>o.map(l=>l.id===t.id?{...l,participants:[...l.participants,i]}:l)),b(o=>o?{...o,participants:[...o.participants,i]}:null),y(o=>{const l=o[t.id]||{};return{...o,[t.id]:{...l,[s]:{total:0}}}}),M(""),_(""),U(!1)},te=a=>{if(!t)return;const r=t.participants.find(s=>s.id===a);r&&(L(a),A(r.teamName),P(r.emails[0]),T(!0))},ae=()=>{if(!F||!$.trim()||!k.trim()||!t)return;const a=t.participants.map(r=>r.id===F?{...r,teamName:$,emails:[k]}:r);f(r=>r.map(s=>s.id===t.id?{...s,participants:a}:s)),b(r=>r?{...r,participants:a}:null),T(!1),L(null),A(""),P("")},re=a=>{if(t&&window.confirm("Are you sure you want to delete this team?")){const r=t.participants.filter(s=>s.id!==a);f(s=>s.map(i=>i.id===t.id?{...i,participants:r}:i)),b(s=>s?{...s,participants:r}:null),y(s=>{const i={...s[t.id]};return delete i[a],{...s,[t.id]:i}})}},se=()=>{if(!t)return;const a=t.rounds.length+1,r=`Round ${a}`,s=`round${a}`,i={...t,rounds:[...t.rounds,r]};f(o=>o.map(l=>l.id===t.id?i:l)),b(i),y(o=>{const d={...o[t.id]||{}};return t.participants.forEach(h=>{const p=d[h.id]||{total:0};d[h.id]={...p,[s]:void 0,total:K(p)}}),{...o,[t.id]:d}})},ne=()=>{H(!S)},oe=a=>!t||!N[t.id]?{total:0}:N[t.id][a]||{total:0};return n("div",{className:"min-h-screen bg-gray-900 text-white",children:[e("div",{className:"md:hidden fixed top-4 right-4 z-50",children:e("button",{onClick:ne,className:"bg-indigo-600 p-2 rounded-full",children:S?e(Ce,{size:24}):e(Se,{size:24})})}),e("div",{className:`${S?"translate-x-0":"-translate-x-full"} md:translate-x-0 fixed top-0 left-0 h-full w-64 bg-gray-800 transition-transform duration-300 ease-in-out z-40 overflow-y-auto max-h-screen`,children:n("div",{className:"p-6",children:[e("h1",{className:"text-2xl font-bold mb-6",children:"KAIROS 25"}),n("div",{className:"mb-8",children:[e("p",{className:"text-gray-400 text-sm",children:"Coordinator"}),e("p",{className:"font-semibold",children:u.coordinatorName}),e("p",{className:"text-gray-400 text-sm",children:u.coordinatorEmail})]}),e("h2",{className:"text-lg font-bold mb-2",children:"Events"}),m.length===0?e("p",{className:"text-gray-400 text-sm",children:"No events available"}):e("ul",{className:"space-y-2",children:m.map(a=>e("li",{children:e("button",{className:`w-full text-left py-2 px-3 rounded ${(t==null?void 0:t.id)===a.id?"bg-indigo-600":"hover:bg-gray-700"}`,onClick:()=>Y(a.id),children:a.name})},a.id))})]})}),n("div",{className:"md:ml-64 p-6",children:[n("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6",children:[e("h2",{className:"text-2xl font-bold mb-4 md:mb-0",children:t?t.name:"Select an Event"}),t&&n("div",{className:"flex space-x-2",children:[e("button",{className:`py-2 px-4 rounded ${E==="scores"?"bg-indigo-600":"bg-gray-700 hover:bg-gray-600"}`,onClick:()=>j("scores"),children:"Scores"}),e("button",{className:`py-2 px-4 rounded ${E==="chart"?"bg-indigo-600":"bg-gray-700 hover:bg-gray-600"}`,onClick:()=>j("chart"),children:"Chart"})]})]}),t&&n("div",{className:"mb-6",children:[e("button",{className:"bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded",onClick:()=>Z(!I),children:I?"Hide Participant Details":"Show Participant Details"}),I&&n("div",{className:"bg-gray-800 rounded-lg p-6 mt-4",children:[e("h3",{className:"text-xl font-bold mb-4",children:"Participant Details"}),t.participants.length===0?e("p",{className:"text-gray-400",children:"No participants added for this event yet."}):e("div",{className:"overflow-x-auto",children:n("table",{className:"w-full text-left",children:[e("thead",{children:n("tr",{className:"border-b border-gray-700",children:[e("th",{className:"pb-2 pr-4",children:"Team Name"}),e("th",{className:"pb-2 pr-4",children:"Participant Names"}),e("th",{className:"pb-2 pr-4",children:"College Name"})]})}),e("tbody",{children:t.participants.map(a=>n("tr",{className:"border-b border-gray-700",children:[e("td",{className:"py-3 pr-4",children:a.teamName}),e("td",{className:"py-3 pr-4",children:a.emails.join(", ")}),e("td",{className:"py-3 pr-4",children:a.collegeCode.split("_")[0]})]},a.id))})]})})]})]}),t?e(me,{children:E==="scores"?n("div",{className:"bg-gray-800 rounded-lg p-6",children:[n("div",{className:"flex justify-between items-center mb-6",children:[n("h3",{className:"text-xl font-bold",children:[t.name," - Team Scores"]}),n("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[n("button",{className:"flex items-center bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded",onClick:()=>U(!z),children:[e($e,{size:18,className:"mr-1"}),"Add Team"]}),e("button",{className:"bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded",onClick:se,children:"Add Round"}),e("button",{className:"bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded",onClick:J,children:"Save Scores"})]})]}),z&&n("div",{className:"bg-gray-700 p-4 rounded-lg mb-6",children:[e("h4",{className:"text-lg font-semibold mb-3",children:"Add New Team"}),n("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[n("div",{children:[e("label",{className:"block text-sm font-medium mb-1",children:"Team Name"}),e("input",{type:"text",value:x,onChange:a=>M(a.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded py-2 px-3 text-white",placeholder:"Enter team name"})]}),n("div",{children:[e("label",{className:"block text-sm font-medium mb-1",children:"Email"}),e("input",{type:"email",value:C,onChange:a=>_(a.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded py-2 px-3 text-white",placeholder:"Enter email"})]})]}),e("div",{className:"flex justify-end",children:e("button",{className:"bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded",onClick:ee,children:"Add Team"})})]}),X&&n("div",{className:"bg-gray-700 p-4 rounded-lg mb-6",children:[e("h4",{className:"text-lg font-semibold mb-3",children:"Edit Team"}),n("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[n("div",{children:[e("label",{className:"block text-sm font-medium mb-1",children:"Team Name"}),e("input",{type:"text",value:$,onChange:a=>A(a.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded py-2 px-3 text-white",placeholder:"Enter team name"})]}),n("div",{children:[e("label",{className:"block text-sm font-medium mb-1",children:"Email"}),e("input",{type:"email",value:k,onChange:a=>P(a.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded py-2 px-3 text-white",placeholder:"Enter email"})]})]}),n("div",{className:"flex justify-end gap-2",children:[e("button",{className:"bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded",onClick:()=>T(!1),children:"Cancel"}),e("button",{className:"bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded",onClick:ae,children:"Update Team"})]})]}),e("div",{className:"overflow-x-auto",children:n("table",{className:"w-full text-left",children:[e("thead",{children:n("tr",{className:"border-b border-gray-700",children:[e("th",{className:"pb-2 pr-4",children:"Team"}),t.rounds.map((a,r)=>e("th",{className:"pb-2 pr-4",children:a},a)),e("th",{className:"pb-2",children:"Total"}),e("th",{className:"pb-2",children:"Actions"})]})}),e("tbody",{children:t.participants.length===0?e("tr",{children:e("td",{colSpan:t.rounds.length+4,className:"py-4 text-center text-gray-400",children:"No teams added for this event yet"})}):t.participants.map(a=>{const r=oe(a.id);return n("tr",{className:"border-b border-gray-700",children:[e("td",{className:"py-3 pr-4",children:a.collegeCode}),t.rounds.map((s,i)=>{const o=`round${i+1}`,l=r[o]!==void 0?r[o]:"";return e("td",{className:"py-3 pr-4",children:e("input",{type:"number",min:"0",max:"100",value:l,onChange:d=>G(a.id,o,d.target.value),className:"w-16 bg-gray-700 border border-gray-600 rounded py-1 px-2 text-white"})},s)}),e("td",{className:"py-3 font-semibold",children:r.total||0}),e("td",{className:"py-3",children:n("div",{className:"flex gap-2",children:[e("button",{onClick:()=>te(a.id),className:"bg-blue-600 hover:bg-blue-700 text-white py-1 px-2 rounded text-sm",children:"Edit"}),e("button",{onClick:()=>re(a.id),className:"bg-red-600 hover:bg-red-700 text-white py-1 px-2 rounded text-sm",children:"Delete"})]})})]},a.id)})})]})}),n("div",{className:"bg-gray-700 p-4 rounded-lg mt-6",children:[n("h3",{className:"text-lg font-bold mb-3",children:[t==null?void 0:t.name," - Team Standings"]}),e("div",{className:"overflow-x-auto",children:n("table",{className:"w-full text-left",children:[e("thead",{children:n("tr",{className:"border-b border-gray-600",children:[e("th",{className:"pb-2",children:"Rank"}),e("th",{className:"pb-2",children:"College Code"}),e("th",{className:"pb-2",children:"Team"}),e("th",{className:"pb-2 text-right",children:"Score"})]})}),n("tbody",{children:[O().map((a,r)=>n("tr",{className:"border-b border-gray-600",children:[e("td",{className:"py-2",children:r+1}),e("td",{className:"py-2",children:`${a.clgCode}`}),e("td",{className:"py-2",children:`${a.teamName} (${a.email})`}),e("td",{className:"py-2 text-right",children:a.score})]},`${a.teamName}-${a.email}-${r}`)),O().length===0&&e("tr",{children:e("td",{colSpan:3,className:"py-4 text-center text-gray-400",children:"No scores recorded for this event yet"})})]})]})})]})]}):n("div",{className:"bg-gray-800 rounded-lg p-6",children:[n("h3",{className:"text-xl font-bold mb-6",children:[t.name," - Score Visualization"]}),t.participants.length===0?e("div",{className:"flex justify-center items-center h-80 text-gray-400",children:"No data available for visualization. Add teams and scores first."}):e("div",{className:"h-96",children:e(he,{data:Q(),options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:100,grid:{color:"rgba(255, 255, 255, 0.1)"}},x:{grid:{display:!1}}},plugins:{legend:{position:"bottom",labels:{color:"white",padding:20}},title:{display:!0,text:`${t.name} Scores by Round`,color:"white",font:{size:16},padding:{bottom:20}}}}})})]})}):e("div",{className:"bg-gray-800 rounded-lg p-6 text-center",children:e("p",{className:"text-lg text-gray-400",children:"Select an event from the sidebar to manage scores"})})]})]})};export{_e as default};
